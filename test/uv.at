# Copyright 2016 (c) Michael Thomas (malinka) <malinka@entropy-development.com>
# Distributed under the terms of the GNU Affero General Public License v3

AT_BANNER([UV Tests])

AT_SETUP([Loop Tests])
AT_SKIP_IF([test -z $LIBUV])
AT_SKIP_IF([test -z $GTEST])
AT_CHECK([uv-loop], [], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([AddrInfo Tests])
AT_SKIP_IF([test -z $LIBUV])
AT_SKIP_IF([test -z $GTEST])
AT_CHECK([uv-addr], [], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([Signal Tests])
AT_SKIP_IF([test -z $LIBUV])
AT_CHECK([uv-signal & pid=$! ; sleep 1s ; kill -INT $pid], [], [ignore], [ignore])
AT_CHECK([uv-signal 15 & pid=$! ; sleep 1s ; kill -TERM $pid], [], [ignore], [ignore])
AT_CHECK([uv-signal 10 & pid=$! ; sleep 1s ; kill -USR1 $pid], [], [ignore], [ignore])
AT_CHECK([uv-signal 12 & pid=$! ; sleep 1s ; kill -USR2 $pid], [], [ignore], [ignore])
AT_CLEANUP
